name: gatekeeper-ci
on:
  push:
    paths:
      - 'k8s-policies/gatekeeper/**'
      - 'k8s/**'
  pull_request:
    paths:
      - 'k8s-policies/gatekeeper/**'
      - 'k8s/**'

jobs:
  gatekeeper-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install gator
        run: |
          curl -sSL -o gator https://github.com/open-policy-agent/gatekeeper/releases/latest/download/gator-linux-amd64
          chmod +x gator && sudo mv gator /usr/local/bin/gator
      - name: Run gator tests
        run: |
          # run verification against Gatekeeper templates + constraints + sample resources
          gator test k8s-policies/gatekeeper || (echo "Gatekeeper policy failures" && exit 1)
